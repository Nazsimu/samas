# Define the path to your text file
$filePath = "C:\path\to\your\file.txt"

# Read the entire file content into an array of lines
$fileContent = Get-Content -Path $filePath

# Variables to store the extracted data
$diskListSection = $false
$smartNVMESection = $false
$driveData = @()
$smartNVMEData = @()
$currentSmartData = @()

# Loop through each line of the file
foreach ($line in $fileContent) {
    # Check if we've reached the "Disk List" section
    if ($line -match "---- Disk List ----") {
        $diskListSection = $true
        continue
    }
    # Exit the "Disk List" section when we encounter another header or blank line
    if ($diskListSection -and ($line -match "^----" -or $line -eq "")) {
        $diskListSection = $false
    }
    
    # Collect drive data under "Disk List"
    if ($diskListSection) {
        $driveData += $line
    }

    # Check if we've reached the "SMART_NVME" section
    if ($line -match "-- SMART_NVME --") {
        $smartNVMESection = $true
        continue
    }

    # Exit the "SMART_NVME" section when we reach another section or header
    if ($smartNVMESection -and ($line -match "^----" -or $line -eq "")) {
        $smartNVMESection = $false
        # Add the collected data of the current drive to the full list if any
        if ($currentSmartData.Count -gt 0) {
            $smartNVMEData += [PSCustomObject]@{
                Drive   = ($driveData[$driveData.Count - 1])  # Link the drive with this SMART_NVME data
                Data    = $currentSmartData
            }
            # Clear for the next drive data
            $currentSmartData = @()
        }
    }

    # Collect hex data under "-- SMART_NVME --" (range from 000 to 1F0)
    if ($smartNVMESection -and ($line -match "^[0-9A-F]{3}\s")) {
        $currentSmartData += $line
    }
}

# Output the number of drives and the drive data
if ($driveData.Count -gt 0) {
    Write-Host "Number of connected drives: $($driveData.Count)"
    Write-Host "Drive data:"
    $driveData | ForEach-Object { Write-Host $_ }
} else {
    Write-Host "No drives found under Disk List."
}

# Output SMART_NVME data for each drive
if ($smartNVMEData.Count -gt 0) {
    foreach ($smart in $smartNVMEData) {
        Write-Host "`nDrive:" $smart.Drive
        Write-Host "SMART_NVME data:"
        $smart.Data | ForEach-Object { Write-Host $_ }
    }
} else {
    Write-Host "No SMART_NVME data found."
}
